# 聚集索引和二级索引

每个 InnoDB 表都有一个特殊的索引，称为聚集索引，用于存储行数据。通常，聚集索引与主键同义。为了从查询、插入和其他数据库操作中获得最佳性能，了解 InnoDB 如何使用聚集索引来优化常见的查找和 DML 操作非常重要。

当您在表上定义 PRIMARY KEY 时，InnoDB 将其用作聚集索引。应该为每个表定义一个主键。如果没有逻辑唯一且非空的列或列集来使用主键，请添加一个自动增量列。自动增量列值是唯一的，并在插入新行时自动添加。

如果您没有为表定义 PRIMARY KEY，则 InnoDB 使用第一个 UNIQUE 索引，其中所有键列都定义为 NOT NULL 作为聚集索引。

如果表没有 PRIMARY KEY 或合适的 UNIQUE 索引，InnoDB 会在包含行 ID 值的合成列上生成一个名为 GEN_CLUST_INDEX 的隐藏聚集索引。这些行按 InnoDB 分配的行 ID 排序。行 ID 是一个 6 字节的字段，随着新行的插入而单调增加。因此，按行 ID 排序的行在物理上是按插入顺序排列的。

## 聚集索引如何加速查询

通过聚集索引访问行很快，因为索引搜索直接指向包含行数据的页面。如果表很大，与使用与索引记录不同的页面存储行数据的存储组织相比，聚集索引架构通常会节省磁盘 I/O 操作。

## 二级索引与聚集索引的关系

聚集索引以外的索引称为二级索引。在 InnoDB 中，二级索引中的每条记录都包含行的主键列，以及为二级索引指定的列。 InnoDB 使用这个主键值来搜索聚集索引中的行。

如果主键长，二级索引占用的空间就更多，所以主键短是有利的。

有关利用 InnoDB 聚集索引和二级索引的指南，请参阅[第 8.3 节，“优化和索引”](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html)。
