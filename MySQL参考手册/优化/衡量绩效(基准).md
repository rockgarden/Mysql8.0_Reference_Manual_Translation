# 衡量绩效（基准）

8.13.1 测量表达和功能的速度
8.13.2 使用自己的基准
8.13.3 用绩效模式衡量绩效

要衡量绩效，请考虑以下因素：

- 无论您是在安静的系统上测量单个操作的速度，还是一组操作（“工作负载”）在一段时间内的工作方式。通过简单的测试，通常可以测试更改一个方面（配置设置、表上的索引集、查询中的SQL子句）对性能的影响。基准测试通常是长时间运行且复杂的性能测试，测试结果可能会决定高级别的选择，例如硬件和存储配置，或者多久升级到新的MySQL版本。

- 对于基准测试，有时必须模拟繁重的数据库工作负载才能获得准确的结果。

- 表现会因许多不同的因素而有所不同，因此几个百分点的差异可能不是决定性的胜利。当您在不同的环境中进行测试时，结果可能会发生相反的变化。

- 某些MySQL特性有助于或不助于性能，具体取决于工作负载。为了完整性，请始终在打开和关闭这些功能的情况下测试性能。对于每个工作负载，最重要的功能是InnoDB表的自适应哈希索引。

本节将从单个开发人员可以使用的简单直接的测量技术发展到更复杂的技术，这些技术需要额外的专业知识来执行和解释结果。

## 测量表达式和函数的速度

要测量特定MySQL表达式或函数的速度，请使用MySQL客户端程序调用[BENCHMARK()](https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_benchmark)函数。其语法为BENCHMARK(loop_count,expr)。返回值始终为零，但mysql会打印一行，显示执行语句所用的大致时间。例如：

```sql
mysql> SELECT BENCHMARK(1000000,1+1);
+------------------------+
| BENCHMARK(1000000,1+1) |
+------------------------+
|                      0 |
+------------------------+
1 row in set (0.32 sec)
```

此结果是在奔腾II 400MHz系统上获得的。它显示MySQL可以在0.32秒内在该系统上执行1000000个简单加法表达式。

内置的MySQL函数通常经过高度优化，但可能会有一些例外。BENCHMARK（）是一个很好的工具，可以用来确定某个函数是否对查询有问题。

## 使用自己的基准

对应用程序和数据库进行基准测试，找出瓶颈所在。在修复了一个瓶颈（或者用一个“虚拟”模块替换它）之后，您可以继续识别下一个瓶颈。即使应用程序的总体性能目前可以接受，您至少应该为每个瓶颈制定一个计划，并决定如果有一天您真的需要额外的性能，如何解决它。

免费的基准测试套件是开源数据库基准测试，可在<http://osdb.sourceforge.net/>.

只有当系统负载很重时才会出现问题，这是很常见的。我们有许多客户在生产（测试）系统并遇到负载问题时与我们联系。在大多数情况下，性能问题是由于基本数据库设计问题（例如，在高负载下表扫描不好）或操作系统或库的问题造成的。大多数时候，如果这些系统还没有投入生产，这些问题将更容易解决。

为了避免这样的问题，请在最坏的负载下对整个应用程序进行基准测试：

- mysqlslap程序有助于模拟多个客户端同时发出查询所产生的高负载。请参阅第4.5.8节，“[mysqlslap-A Load Emulation Client](https://dev.mysql.com/doc/refman/8.0/en/mysqlslap.html)”。

- 您还可以尝试基准测试包，如SysBench和DBT2，网址为<https://launchpad.net/sysbench>和<http://osdldbt.sourceforge.net/#dbt2>.

这些程序或包可能会使系统崩溃，因此请确保只在您的开发系统上使用它们。

## 用绩效衡量绩效_schema

您可以查询performance_schema数据库中的表，以查看有关服务器及其运行的应用程序的性能特性的实时信息。
